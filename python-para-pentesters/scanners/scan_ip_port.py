# -*- coding:utf-8 -*-

#####################################################
#                                                   #
#   Python para Pentesters                          #
#   https://solyd.com.br/treinamentos               #
#                                                   #
#   Desenvolvedor: h1s0k4                           #
#   E-mail: willian_brito00@hotmail.com             #
#                                                   #
#   USAGE: python scan_ip_port.py                   #
#                                                   #
#####################################################

import socket
import ipaddress
import sys

ip = "192.168.15.0/24"
ports = {21, 22, 23, 25, 53, 80, 110, 111, 135, 139, 143, 443, 445, 993, 995, 1723, 3306, 3389, 5900, 8080}
ips_ativos = []

# VERIFICA SE O IP Ã‰ VALIDO
try:
	ips = ipaddress.ip_network(unicode(ip), strict=False)

except:
	print "IP Invalido !!"
	sys.exit()

# LISTA IPs ONLINE
try:
	print "\n===================="
	print "    Hosts Ativos     "
	print "===================="
	for host in ips:
		client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
		client.settimeout(0.05)
		code = client.connect_ex((unicode(host), 80))

		if code == 0:
			print "\n#", host
			ips_ativos.append(host)

			# LISTA PORTAS ABERTAS
			for port in ports:

			    client2 = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
			    client2.settimeout(0.05)
			    code2 = client2.connect_ex((unicode(host), port))
			    client2.close()

			    if code2 == 0:
			    	print "\tOPEN: ",str(port)
except KeyboardInterrupt:
		print " Saindo do Programa !!\n"
		sys.exit()

print"\nExistem %s dispositivos online neste momento\n\n" % len(ips_ativos)

#main()	
