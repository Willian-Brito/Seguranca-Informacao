# -*- coding:utf-8 -*-

#####################################################
#                                                   #
#   Python para Pentesters                          #
#   https://solyd.com.br/treinamentos               #
#                                                   #
#   Desenvolvedor: h1s0k4                           #
#   E-mail: willian_brito00@hotmail.com             #
#                                                   #
#   USAGE: python nmap_script.py 192.168.15.1/24    #
#                                                   #
#####################################################

import nmap
import sys


try:

	print "\n# Running ..\n"
	ip = sys.argv[1]
	ports = [21, 22, 23, 25, 53, 80, 110, 111, 135, 139, 143, 443, 445, 993, 995, 1723, 3306, 3389, 5900, 8080]
	ips_ativos = 0

	scanNmap = nmap.PortScanner()
	scanNmap.scan(ip, str(ports), "-Pn")

except:
	print "\n -> USAGE: sudo python nmap_script.py 192.168.15.1/24\n"
	sys.exit()


try:
	for host in scanNmap.all_hosts():
		print "\nNmap scan report for", host
		print "Host is ", scanNmap[host]["status"]["state"]
		ips_ativos += 1

		try:
			for protocolo in scanNmap[host].all_protocols():
				print "\n[+]PORT\t\t[+]STATE\t[+]SERVICE\n"
				
				for porta in scanNmap[host][protocolo]:
					alvo = scanNmap[host][protocolo][porta]
					if alvo["state"] == "open":
						print "  " + str(porta) + "/"+ protocolo + "\t   " + alvo["state"] + "\t\t  " + alvo["name"]
			enderecoMac = scanNmap[host]["addresses"]["mac"]
			print "\nMAC Address " + enderecoMac + " ( " +  scanNmap[host]["vendor"][enderecoMac] + " )\n"
			print "---------------------------------------------------------------"
		except:
			print "\nErro no MAC Address\n"
			print "---------------------------------------------------------------"
except:
	print "Erro no Script"
		 
print"\n-> Existem %s Dispositivos Online neste Momento\n\n" % ips_ativos


		 